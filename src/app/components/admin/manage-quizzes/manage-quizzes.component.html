<div class="manage-quizzes">
  <div class="page-header">
    <div class="header-content">
      <lucide-icon name="clipboard-list" [size]="32"></lucide-icon>
      <div>
        <h1>Manage Quizzes</h1>
        <p>Create and manage quizzes for lessons</p>
      </div>
    </div>
  </div>

  <div class="quiz-container">
    <!-- Course and Lesson Selection -->
    <div class="selection-section">
      <div class="form-group">
        <label for="course">
          <lucide-icon name="book-open" [size]="20"></lucide-icon>
          <span>Select Course</span>
        </label>
        <select 
          id="course" 
          [(ngModel)]="selectedCourseId" 
          (change)="onCourseChange()"
          class="form-control"
        >
          <option [value]="null">Choose a course...</option>
          <option *ngFor="let course of courses" [value]="course.id">
            {{ course.title }}
          </option>
        </select>
      </div>

      <div class="form-group" *ngIf="selectedCourseId">
        <label for="lesson">
          <lucide-icon name="file-text" [size]="20"></lucide-icon>
          <span>Select Lesson</span>
        </label>
        <select 
          id="lesson" 
          [(ngModel)]="selectedLessonId" 
          (change)="onLessonChange()"
          class="form-control"
        >
          <option [value]="null">Choose a lesson...</option>
          <option *ngFor="let lesson of lessons" [value]="lesson.id">
            {{ lesson.title }}
          </option>
        </select>
      </div>
    </div>

    <!-- Quiz Form -->
    <div class="quiz-form" *ngIf="selectedLessonId && !isLoading">
      <div class="form-section">
        <h2>
          <lucide-icon name="clipboard-check" [size]="24"></lucide-icon>
          <span>Quiz Details</span>
        </h2>
        
        <div class="form-group">
          <label for="quizTitle">Quiz Title</label>
          <input 
            type="text" 
            id="quizTitle" 
            [(ngModel)]="quiz.title" 
            placeholder="Enter quiz title"
            class="form-control"
          />
        </div>
      </div>

      <!-- Add Question Section -->
      <div class="form-section">
        <h2>
          <lucide-icon name="help-circle" [size]="24"></lucide-icon>
          <span>Add Question</span>
        </h2>

        <div class="form-group">
          <label for="questionText">Question</label>
          <textarea 
            id="questionText" 
            [(ngModel)]="currentQuestion.questionText" 
            placeholder="Enter your question"
            rows="3"
            class="form-control"
          ></textarea>
        </div>

        <div class="options-grid">
          <div class="form-group">
            <label for="optionA">Option A</label>
            <input 
              type="text" 
              id="optionA" 
              [(ngModel)]="currentQuestion.optionA" 
              placeholder="Option A"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label for="optionB">Option B</label>
            <input 
              type="text" 
              id="optionB" 
              [(ngModel)]="currentQuestion.optionB" 
              placeholder="Option B"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label for="optionC">Option C</label>
            <input 
              type="text" 
              id="optionC" 
              [(ngModel)]="currentQuestion.optionC" 
              placeholder="Option C"
              class="form-control"
            />
          </div>

          <div class="form-group">
            <label for="optionD">Option D</label>
            <input 
              type="text" 
              id="optionD" 
              [(ngModel)]="currentQuestion.optionD" 
              placeholder="Option D"
              class="form-control"
            />
          </div>
        </div>

        <div class="form-group">
          <label for="correctAnswer">Correct Answer</label>
          <select 
            id="correctAnswer" 
            [(ngModel)]="currentQuestion.correctAnswer" 
            class="form-control"
          >
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="C">C</option>
            <option value="D">D</option>
          </select>
        </div>

        <button class="btn-add-question" (click)="addQuestion()">
          <lucide-icon name="plus" [size]="20"></lucide-icon>
          <span>Add Question</span>
        </button>
      </div>

      <!-- Existing Questions -->
      <div class="form-section" *ngIf="existingQuestions.length > 0">
        <h2>
          <lucide-icon name="check-circle" [size]="24"></lucide-icon>
          <span>Saved Questions ({{ existingQuestions.length }})</span>
        </h2>

        <div class="questions-list">
          <div class="question-card saved" *ngFor="let question of existingQuestions; let i = index">
            <div class="question-header">
              <span class="question-number">Q{{ i + 1 }}</span>
              <div class="header-actions">
                <span class="saved-badge">âœ“ Saved</span>
                <button class="btn-remove" (click)="deleteExistingQuestion(question.id, i)">
                  <lucide-icon name="trash-2" [size]="18"></lucide-icon>
                </button>
              </div>
            </div>
            <p class="question-text">{{ question.questionText }}</p>
            <div class="question-options">
              <div class="option" [class.correct]="question.correctAnswer === 'A'">
                <span class="option-label">A:</span>
                <span>{{ question.optionA }}</span>
              </div>
              <div class="option" [class.correct]="question.correctAnswer === 'B'">
                <span class="option-label">B:</span>
                <span>{{ question.optionB }}</span>
              </div>
              <div class="option" [class.correct]="question.correctAnswer === 'C'">
                <span class="option-label">C:</span>
                <span>{{ question.optionC }}</span>
              </div>
              <div class="option" [class.correct]="question.correctAnswer === 'D'">
                <span class="option-label">D:</span>
                <span>{{ question.optionD }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- New Questions to be Saved -->
      <div class="form-section">
        <h2>
          <lucide-icon name="list" [size]="24"></lucide-icon>
          <span>New Questions ({{ newQuestions.length }})</span>
        </h2>

        <div class="no-questions" *ngIf="newQuestions.length === 0">
          <lucide-icon name="inbox" [size]="48" [strokeWidth]="1.5"></lucide-icon>
          <p>No new questions added yet. Add your first question above!</p>
        </div>

        <div class="questions-list" *ngIf="newQuestions.length > 0">
          <div class="question-card" *ngFor="let question of newQuestions; let i = index">
            <div class="question-header">
              <span class="question-number">Q{{ i + 1 }}</span>
              <button class="btn-remove" (click)="removeQuestion(i)">
                <lucide-icon name="trash-2" [size]="18"></lucide-icon>
              </button>
            </div>
            <p class="question-text">{{ question.questionText }}</p>
            <div class="question-options">
              <div class="option" [class.correct]="question.correctAnswer === 'A'">
                <span class="option-label">A:</span>
                <span>{{ question.optionA }}</span>
              </div>
              <div class="option" [class.correct]="question.correctAnswer === 'B'">
                <span class="option-label">B:</span>
                <span>{{ question.optionB }}</span>
              </div>
              <div class="option" [class.correct]="question.correctAnswer === 'C'">
                <span class="option-label">C:</span>
                <span>{{ question.optionC }}</span>
              </div>
              <div class="option" [class.correct]="question.correctAnswer === 'D'">
                <span class="option-label">D:</span>
                <span>{{ question.optionD }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

     
      <div class="form-actions">
        <button class="btn-save" (click)="saveQuiz()" [disabled]="isLoading">
          <lucide-icon name="check-circle" [size]="20"></lucide-icon>
          <span>{{ existingQuiz ? 'Update Quiz' : 'Create Quiz' }}</span>
        </button>
      </div>
    </div>

   
    <div class="loading-state" *ngIf="isLoading">
      <div class="spinner">
        <img src="assets/loading.png" alt="loading" />
      </div>
      <p>Loading...</p>
    </div>

   
    <div class="empty-state" *ngIf="!selectedLessonId && !isLoading">
      <lucide-icon name="clipboard-list" [size]="80" [strokeWidth]="1.5"></lucide-icon>
      <h3>Select a Lesson</h3>
      <p>Choose a course and lesson to create or manage quizzes</p>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal-overlay" *ngIf="showDeleteModal" (click)="closeDeleteModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <lucide-icon name="alert-triangle" [size]="48" class="warning-icon"></lucide-icon>
        <h2>Delete Question?</h2>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this question?</p>
        <p class="warning-text">This action cannot be undone.</p>
      </div>
      <div class="modal-actions">
        <button class="btn-cancel" (click)="closeDeleteModal()">
          <lucide-icon name="x" [size]="20"></lucide-icon>
          <span>Cancel</span>
        </button>
        <button class="btn-delete" (click)="confirmDelete()">
          <lucide-icon name="trash-2" [size]="20"></lucide-icon>
          <span>Delete</span>
        </button>
      </div>
    </div>
  </div>
</div>
